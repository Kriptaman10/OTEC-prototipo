<!DOCTYPE html>
<html class="light" lang="es">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Nueva Solicitud de Curso - Sistema de Gestión OTEC</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#136dec",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101822",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        .input-error {
            border-color: #EF4444 !important;
        }
        .error-message {
            color: #EF4444;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }
        .error-message.show {
            display: block;
        }
        .drag-over {
            border-color: #136dec !important;
            background-color: rgba(19, 109, 236, 0.05) !important;
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transform: translateX(400px);
            transition: all 0.3s ease;
        }
        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }
        .progress-bar {
            height: 4px;
            background: #e5e7eb;
            position: fixed;
            top: 64px;
            left: 0;
            right: 0;
            z-index: 50;
        }
        .progress-bar-fill {
            height: 100%;
            background: #136dec;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-[#111418] dark:text-gray-100 min-h-screen flex flex-col font-display antialiased">
    <!-- Progress Bar -->
    <div class="progress-bar">
        <div id="progressBarFill" class="progress-bar-fill" style="width: 0%"></div>
    </div>

    <!-- Header -->
    <header class="sticky top-0 z-50 bg-white dark:bg-[#1a202c] border-b border-[#f0f2f4] dark:border-gray-800 shadow-sm">
        <div class="max-w-[1280px] mx-auto px-4 sm:px-8 lg:px-10 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="text-primary">
                    <span class="material-symbols-outlined text-3xl">school</span>
                </div>
                <h1 class="text-lg font-bold tracking-tight text-[#111418] dark:text-white">Sistema de Gestión OTEC</h1>
            </div>
            <div class="flex items-center gap-6">
                <button class="p-2 text-gray-500 hover:text-primary transition-colors relative">
                    <span class="material-symbols-outlined">notifications</span>
                    <span class="absolute top-2 right-2 size-2 bg-red-500 rounded-full border-2 border-white dark:border-[#1a202c]"></span>
                </button>
                <div class="bg-center bg-no-repeat bg-cover rounded-full size-9 border border-gray-200 dark:border-gray-700 cursor-pointer" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDp-MScAacUEG7qkQWhFCRSv8ayKI48R1ZnBtx1n3afcAfwYgOOCxSBySL2kdLaUk3iP3Fawm58My2u3Ffo3JTok381v3Acv9w99gb2kvE4009qKcc8IzWLG-ET8QBMcxUrk_xuSnRZSrVkfNQhVCOiKaG077EWLh3NJKKgs6T36j1Y3_dNH-msACNyFK120FWNU2V4flIFZWUSOCWVRjJmN1Z2ERcUvQu0YP_FOFEqDdeOZgKDa6CsvDCSxTPdtZP-r0c6n6n33nU");'>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow flex flex-col items-center py-8 px-4 sm:px-6">
        <div class="w-full max-w-[960px] flex flex-col gap-6">
            <!-- Breadcrumb -->
            <nav class="flex items-center gap-2 text-sm text-[#617289] dark:text-gray-400">
                <a class="hover:text-primary transition-colors flex items-center gap-1" href="dashboard.html">
                    <span class="material-symbols-outlined text-[18px]">home</span> Inicio
                </a>
                <span class="material-symbols-outlined text-[16px]">chevron_right</span>
                <a class="hover:text-primary transition-colors" href="solicitudes-listado.html">Solicitudes</a>
                <span class="material-symbols-outlined text-[16px]">chevron_right</span>
                <span class="font-medium text-[#111418] dark:text-white">Nueva Solicitud</span>
            </nav>

            <!-- Title -->
            <div class="flex flex-col gap-2">
                <h2 class="text-3xl font-bold tracking-tight text-[#111418] dark:text-white">Nueva Solicitud de Curso - OTEC</h2>
                <p class="text-[#617289] dark:text-gray-400 text-base">
                    Complete el formulario a continuación para gestionar su requerimiento de capacitación corporativa.
                </p>
            </div>

            <!-- Form -->
            <form id="formSolicitud" class="bg-white dark:bg-[#1a202c] rounded-xl shadow-sm border border-[#e2e8f0] dark:border-gray-700 overflow-hidden">
                <!-- Datos del Solicitante -->
                <div class="p-6 md:p-8 border-b border-[#f0f2f4] dark:border-gray-700">
                    <div class="flex items-center gap-2 mb-6 text-primary">
                        <span class="material-symbols-outlined">person</span>
                        <h3 class="text-lg font-bold text-[#111418] dark:text-white">Datos del Solicitante</h3>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="flex flex-col gap-2">
                            <label class="text-sm font-medium text-[#111418] dark:text-gray-200" for="name">
                                Nombre Completo <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <input
                                    class="w-full rounded-lg border border-[#dbe0e6] dark:border-gray-600 bg-white dark:bg-[#2d3748] text-[#111418] dark:text-white h-12 px-4 focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all placeholder:text-gray-400"
                                    id="name"
                                    placeholder="Ej. Juan Pérez"
                                    type="text"
                                    required
                                />
                            </div>
                            <span class="error-message" id="nameError">El nombre debe tener al menos 3 caracteres</span>
                        </div>
                        <div class="flex flex-col gap-2">
                            <label class="text-sm font-medium text-[#111418] dark:text-gray-200" for="email">
                                Correo Corporativo o Gmail <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <input
                                    class="w-full rounded-lg border border-[#dbe0e6] dark:border-gray-600 bg-white dark:bg-[#2d3748] text-[#111418] dark:text-white h-12 px-4 focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all placeholder:text-gray-400"
                                    id="email"
                                    placeholder="nombre@empresa.com"
                                    type="email"
                                    required
                                />
                            </div>
                            <span class="error-message" id="emailError">Ingrese un correo electrónico válido</span>
                        </div>
                    </div>
                </div>

                <!-- Datos de la Empresa -->
                <div class="p-6 md:p-8 border-b border-[#f0f2f4] dark:border-gray-700 bg-gray-50/50 dark:bg-[#1e2736]/30">
                    <div class="flex items-center gap-2 mb-6 text-primary">
                        <span class="material-symbols-outlined">domain</span>
                        <h3 class="text-lg font-bold text-[#111418] dark:text-white">Datos de la Empresa</h3>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="flex flex-col gap-2">
                            <label class="text-sm font-medium text-[#111418] dark:text-gray-200" for="holding">
                                Empresa Holding <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <select
                                    class="w-full appearance-none rounded-lg border border-[#dbe0e6] dark:border-gray-600 bg-white dark:bg-[#2d3748] text-[#111418] dark:text-white h-12 px-4 pr-10 focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all cursor-pointer"
                                    id="holding"
                                    required
                                >
                                    <option disabled selected value="">Seleccione una empresa</option>
                                </select>
                                <span class="material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none">expand_more</span>
                            </div>
                        </div>
                        <div class="flex flex-col gap-2">
                            <label class="text-sm font-medium text-[#111418] dark:text-gray-200" for="cost_center">
                                Centro de Gestión (Código) <span class="text-red-500">*</span>
                            </label>
                            <input
                                class="w-full rounded-lg border border-[#dbe0e6] dark:border-gray-600 bg-white dark:bg-[#2d3748] text-[#111418] dark:text-white h-12 px-4 focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all placeholder:text-gray-400 font-mono"
                                id="cost_center"
                                placeholder="CC-2024-X89"
                                type="text"
                                required
                            />
                            <span class="error-message" id="costCenterError">Formato: CC-XXXX-XXX</span>
                        </div>
                    </div>
                </div>

                <!-- Datos del Curso -->
                <div class="p-6 md:p-8 border-b border-[#f0f2f4] dark:border-gray-700">
                    <div class="flex items-center gap-2 mb-6 text-primary">
                        <span class="material-symbols-outlined">menu_book</span>
                        <h3 class="text-lg font-bold text-[#111418] dark:text-white">Datos del Curso</h3>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
                        <div class="md:col-span-12 flex flex-col gap-2">
                            <label class="text-sm font-medium text-[#111418] dark:text-gray-200" for="course_name">
                                Nombre del Curso a solicitar <span class="text-red-500">*</span>
                            </label>
                            <input
                                class="w-full rounded-lg border border-[#dbe0e6] dark:border-gray-600 bg-white dark:bg-[#2d3748] text-[#111418] dark:text-white h-12 px-4 focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all placeholder:text-gray-400"
                                id="course_name"
                                placeholder="Ej. Taller de Liderazgo Efectivo"
                                type="text"
                                required
                            />
                        </div>
                        <div class="md:col-span-6 flex flex-col gap-2">
                            <label class="text-sm font-medium text-[#111418] dark:text-gray-200" for="training_type">
                                Tipo de Capacitación <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <select
                                    class="w-full appearance-none rounded-lg border border-[#dbe0e6] dark:border-gray-600 bg-white dark:bg-[#2d3748] text-[#111418] dark:text-white h-12 px-4 pr-10 focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all cursor-pointer"
                                    id="training_type"
                                    required
                                >
                                    <option disabled selected value="">Seleccione tipo</option>
                                    <option value="curso_normal">Curso Normal</option>
                                    <option value="curso_precontrato">Curso Precontrato</option>
                                </select>
                                <span class="material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none">expand_more</span>
                            </div>
                        </div>
                        <div class="md:col-span-6 flex flex-col gap-2">
                            <label class="text-sm font-medium text-[#111418] dark:text-gray-200" for="modality">
                                Modalidad <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <select
                                    class="w-full appearance-none rounded-lg border border-[#dbe0e6] dark:border-gray-600 bg-white dark:bg-[#2d3748] text-[#111418] dark:text-white h-12 px-4 pr-10 focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all cursor-pointer"
                                    id="modality"
                                    required
                                >
                                    <option disabled selected value="">Seleccione modalidad</option>
                                    <option value="presencial">Presencial (In-Company)</option>
                                    <option value="sincronico">E-Learning Sincrónico</option>
                                    <option value="asincronico">E-Learning Asincrónico</option>
                                    <option value="distancia">A Distancia</option>
                                </select>
                                <span class="material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none">expand_more</span>
                            </div>
                        </div>
                        <div class="md:col-span-6 flex flex-col gap-2">
                            <label class="text-sm font-medium text-[#111418] dark:text-gray-200" for="hours_qty">
                                Cantidad de Horas <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <select
                                    class="w-full appearance-none rounded-lg border border-[#dbe0e6] dark:border-gray-600 bg-white dark:bg-[#2d3748] text-[#111418] dark:text-white h-12 px-4 pr-10 focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all cursor-pointer"
                                    id="hours_qty"
                                    required
                                >
                                    <option disabled selected value="">Seleccione duración</option>
                                    <option value="4">4 Horas</option>
                                    <option value="8">8 Horas</option>
                                    <option value="12">12 Horas</option>
                                    <option value="16">16 Horas</option>
                                    <option value="24">24 Horas</option>
                                    <option value="32">32 Horas</option>
                                    <option value="otro">Otro</option>
                                </select>
                                <span class="material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none">expand_more</span>
                            </div>
                        </div>
                        <div id="customHoursContainer" class="md:col-span-6 flex-col gap-2" style="display: none;">
                            <label class="text-sm font-medium text-[#111418] dark:text-gray-200" for="custom_hours">
                                Especifique Horas <span class="text-red-500">*</span>
                            </label>
                            <input
                                class="w-full rounded-lg border border-[#dbe0e6] dark:border-gray-600 bg-white dark:bg-[#2d3748] text-[#111418] dark:text-white h-12 px-4 focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all placeholder:text-gray-400"
                                id="custom_hours"
                                min="4"
                                placeholder="Debe ser múltiplo de 4"
                                step="4"
                                type="number"
                            />
                            <span class="error-message" id="customHoursError">Debe ser múltiplo de 4</span>
                        </div>
                        <div class="md:col-span-6 flex flex-col gap-2">
                            <label class="text-sm font-medium text-[#111418] dark:text-gray-200" for="participants">
                                Cantidad Participantes <span class="text-red-500">*</span>
                            </label>
                            <input
                                class="w-full rounded-lg border border-[#dbe0e6] dark:border-gray-600 bg-white dark:bg-[#2d3748] text-[#111418] dark:text-white h-12 px-4 focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all placeholder:text-gray-400"
                                id="participants"
                                min="5"
                                max="100"
                                placeholder="Entre 5 y 100"
                                type="number"
                                required
                            />
                            <span class="error-message" id="participantsError">Debe ser entre 5 y 100 participantes</span>
                        </div>
                        <div class="md:col-span-4 flex flex-col gap-2">
                            <label class="text-sm font-medium text-[#111418] dark:text-gray-200" for="start_date">
                                Fecha Inicio <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <input
                                    class="w-full rounded-lg border border-[#dbe0e6] dark:border-gray-600 bg-white dark:bg-[#2d3748] text-[#111418] dark:text-white h-12 px-4 focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all placeholder:text-gray-400 [color-scheme:light] dark:[color-scheme:dark]"
                                    id="start_date"
                                    type="date"
                                    required
                                />
                            </div>
                            <span class="error-message" id="startDateError">No puede ser una fecha pasada</span>
                        </div>
                        <div class="md:col-span-4 flex flex-col gap-2">
                            <label class="text-sm font-medium text-[#111418] dark:text-gray-200" for="end_date">
                                Fecha Término <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <input
                                    class="w-full rounded-lg border border-[#dbe0e6] dark:border-gray-600 bg-white dark:bg-[#2d3748] text-[#111418] dark:text-white h-12 px-4 focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all placeholder:text-gray-400 [color-scheme:light] dark:[color-scheme:dark]"
                                    id="end_date"
                                    type="date"
                                    required
                                />
                            </div>
                            <span class="error-message" id="endDateError">Debe ser mayor o igual a fecha inicio</span>
                        </div>
                        <div class="md:col-span-4 flex flex-col gap-2">
                            <label class="text-sm font-medium text-[#111418] dark:text-gray-200" for="schedule">
                                Horario del Curso
                            </label>
                            <div class="relative">
                                <select
                                    class="w-full appearance-none rounded-lg border border-[#dbe0e6] dark:border-gray-600 bg-white dark:bg-[#2d3748] text-[#111418] dark:text-white h-12 px-4 pr-10 focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all cursor-pointer"
                                    id="schedule"
                                >
                                    <option disabled selected value="">Seleccione horario</option>
                                    <option value="08:00 - 13:00">Jornada Mañana (08:00 - 13:00)</option>
                                    <option value="08:00 - 17:00">Jornada Completa (08:00 - 17:00)</option>
                                    <option value="09:00 - 18:00">Jornada Completa (09:00 - 18:00)</option>
                                    <option value="14:00 - 18:00">Jornada Tarde (14:00 - 18:00)</option>
                                    <option value="18:00 - 22:00">Jornada Vespertina (18:00 - 22:00)</option>
                                    <option value="19:00 - 22:00">Jornada Nocturna (19:00 - 22:00)</option>
                                    <option value="08:30 - 12:30">Media Jornada Mañana (08:30 - 12:30)</option>
                                    <option value="14:30 - 18:30">Media Jornada Tarde (14:30 - 18:30)</option>
                                </select>
                                <span class="material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none">expand_more</span>
                            </div>
                        </div>

                        <!-- Servicios Solicitados (Solo Presencial) -->
                        <div id="serviciosSection" class="md:col-span-12 mt-2 pt-6 border-t border-[#f0f2f4] dark:border-gray-700" style="display: none;">
                            <label class="text-sm font-bold text-[#111418] dark:text-white mb-4 block">
                                Servicios Solicitados (Solo para Presencial)
                                <span class="text-gray-400 font-normal ml-1">(Opcional)</span>
                            </label>
                            <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                                <label class="flex items-center gap-3 cursor-pointer p-3 rounded-lg border border-[#f0f2f4] dark:border-gray-700 hover:border-primary/50 hover:bg-primary/5 transition-all">
                                    <input class="w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary cursor-pointer form-checkbox" type="checkbox" name="servicio" value="almuerzo"/>
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Almuerzo</span>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer p-3 rounded-lg border border-[#f0f2f4] dark:border-gray-700 hover:border-primary/50 hover:bg-primary/5 transition-all">
                                    <input class="w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary cursor-pointer form-checkbox" type="checkbox" name="servicio" value="coffee"/>
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Coffee Break</span>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer p-3 rounded-lg border border-[#f0f2f4] dark:border-gray-700 hover:border-primary/50 hover:bg-primary/5 transition-all">
                                    <input class="w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary cursor-pointer form-checkbox" type="checkbox" name="servicio" value="sala"/>
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Sala de Clases</span>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer p-3 rounded-lg border border-[#f0f2f4] dark:border-gray-700 hover:border-primary/50 hover:bg-primary/5 transition-all">
                                    <input class="w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary cursor-pointer form-checkbox" type="checkbox" id="servicioOtro" name="servicio" value="otro"/>
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Otro</span>
                                </label>
                            </div>
                            <div id="otroServicioContainer" class="mt-4" style="display: none;">
                                <input
                                    class="w-full rounded-lg border border-[#dbe0e6] dark:border-gray-600 bg-white dark:bg-[#2d3748] text-[#111418] dark:text-white h-12 px-4 focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all placeholder:text-gray-400"
                                    id="otro_servicio"
                                    placeholder="Especifique otro servicio..."
                                    type="text"
                                />
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cargar Lista de Participantes -->
                <div class="p-6 md:p-8 bg-gray-50/50 dark:bg-[#1e2736]/30">
                    <div class="flex items-center gap-2 mb-4 text-primary">
                        <span class="material-symbols-outlined">upload_file</span>
                        <h3 class="text-lg font-bold text-[#111418] dark:text-white">Cargar Lista de Participantes (Excel)</h3>
                    </div>
                    <div class="relative group cursor-pointer">
                        <input
                            accept=".xlsx,.xls,.csv"
                            class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"
                            id="file_upload"
                            type="file"
                        />
                        <div id="dropZone" class="border-2 border-dashed border-[#dbe0e6] dark:border-gray-600 rounded-xl p-10 flex flex-col items-center justify-center text-center bg-white dark:bg-[#2d3748] group-hover:border-primary/50 group-hover:bg-primary/5 transition-all">
                            <div class="size-16 rounded-full bg-primary/10 flex items-center justify-center mb-4 group-hover:bg-primary/20 transition-colors">
                                <span class="material-symbols-outlined text-3xl text-primary">cloud_upload</span>
                            </div>
                            <p class="text-base font-medium text-[#111418] dark:text-white mb-1">
                                <span class="text-primary hover:underline">Haga clic para subir</span> o arrastre y suelte
                            </p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">
                                Archivos soportados: .xlsx, .xls, .csv (Max 5MB)
                            </p>
                        </div>
                    </div>
                    <div id="fileInfo" class="mt-4" style="display: none;">
                        <div class="flex items-center gap-3 p-4 bg-white dark:bg-[#2d3748] rounded-lg border border-[#dbe0e6] dark:border-gray-600">
                            <span class="material-symbols-outlined text-green-600 text-2xl">description</span>
                            <div class="flex-1">
                                <p id="fileName" class="text-sm font-medium text-[#111418] dark:text-white">archivo.xlsx</p>
                                <p id="fileSize" class="text-xs text-gray-500">0 KB</p>
                            </div>
                            <button type="button" onclick="removeFile()" class="text-red-500 hover:text-red-700">
                                <span class="material-symbols-outlined">close</span>
                            </button>
                        </div>
                    </div>
                    <div class="mt-2 flex items-center gap-2">
                        <span class="material-symbols-outlined text-sm text-gray-400">info</span>
                        <a onclick="descargarPlantilla()" class="text-xs text-primary hover:underline font-medium cursor-pointer">Descargar plantilla de ejemplo</a>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="p-6 md:p-8 flex items-center justify-end border-t border-[#f0f2f4] dark:border-gray-700 bg-white dark:bg-[#1a202c]">
                    <div class="flex gap-4">
                        <button
                            id="btnCancelar"
                            class="px-6 py-3 rounded-lg text-sm font-bold text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
                            type="button"
                        >
                            Cancelar
                        </button>
                        <button
                            id="btnSubmit"
                            class="px-8 py-3 rounded-lg text-sm font-bold text-white bg-primary hover:bg-primary/90 shadow-md hover:shadow-lg transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                            type="submit"
                            disabled
                        >
                            <span id="submitText">Enviar Solicitud</span>
                            <span id="submitIcon" class="material-symbols-outlined text-lg">send</span>
                            <span id="submitLoader" class="material-symbols-outlined text-lg animate-spin" style="display: none;">progress_activity</span>
                        </button>
                    </div>
                </div>
            </form>

            <div class="h-10"></div>
        </div>
    </main>

    <script>
        // Mock data - Empresas
        const mockEmpresas = [
            { id: 1, nombre: "TechCorp SpA", rut: "76.123.456-7", centroGestion: "CC-2024-TC1" },
            { id: 2, nombre: "Minera Los Andes", rut: "81.234.567-8", centroGestion: "CC-2024-MLA" },
            { id: 3, nombre: "Constructora Horizonte", rut: "92.345.678-9", centroGestion: "CC-2024-CHZ" },
            { id: 4, nombre: "Logística Express Ltda", rut: "77.456.789-0", centroGestion: "CC-2024-LEX" },
            { id: 5, nombre: "Grupo Retail Chile", rut: "88.567.890-1", centroGestion: "CC-2024-GRC" },
            { id: 6, nombre: "Servicios Corporativos SA", rut: "79.678.901-2", centroGestion: "CC-2024-SCS" },
            { id: 7, nombre: "Agroindustrial del Sur", rut: "80.789.012-3", centroGestion: "CC-2024-ADS" },
            { id: 8, nombre: "Energía Renovable SpA", rut: "82.890.123-4", centroGestion: "CC-2024-ERV" },
            { id: 9, nombre: "Transportes Nacionales", rut: "83.901.234-5", centroGestion: "CC-2024-TRN" },
            { id: 10, nombre: "Salud Integral Ltda", rut: "84.012.345-6", centroGestion: "CC-2024-SIL" },
            { id: 11, nombre: "Inversiones Austral", rut: "85.123.456-7", centroGestion: "CC-2024-IAU" },
            { id: 12, nombre: "Manufactura Industrial", rut: "86.234.567-8", centroGestion: "CC-2024-MFI" },
            { id: 13, nombre: "Comercio Mayorista SpA", rut: "87.345.678-9", centroGestion: "CC-2024-CMY" },
            { id: 14, nombre: "Telecomunicaciones Chile", rut: "89.456.789-0", centroGestion: "CC-2024-TLC" },
            { id: 15, nombre: "Forestal Patagonia", rut: "90.567.890-1", centroGestion: "CC-2024-FPT" }
        ];

        // State
        let archivoSubido = null;
        let formData = {};

        // Populate empresas dropdown
        function populateEmpresas() {
            const select = document.getElementById('holding');
            mockEmpresas.forEach(empresa => {
                const option = document.createElement('option');
                option.value = empresa.id;
                option.textContent = empresa.nombre;
                select.appendChild(option);
            });
        }

        // Auto-complete centro de gestion
        document.getElementById('holding').addEventListener('change', (e) => {
            const empresaId = parseInt(e.target.value);
            const empresa = mockEmpresas.find(emp => emp.id === empresaId);
            if (empresa) {
                document.getElementById('cost_center').value = empresa.centroGestion;
            }
            validateField('cost_center');
            updateProgress();
            autoSave();
        });

        // Show/hide custom hours input
        document.getElementById('hours_qty').addEventListener('change', (e) => {
            const container = document.getElementById('customHoursContainer');
            if (e.target.value === 'otro') {
                container.style.display = 'flex';
                document.getElementById('custom_hours').required = true;
            } else {
                container.style.display = 'none';
                document.getElementById('custom_hours').required = false;
                document.getElementById('custom_hours').value = '';
            }
            updateProgress();
            autoSave();
        });

        // Show/hide servicios section based on modality
        document.getElementById('modality').addEventListener('change', (e) => {
            const section = document.getElementById('serviciosSection');
            if (e.target.value === 'presencial') {
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
                // Uncheck all
                document.querySelectorAll('input[name="servicio"]').forEach(cb => cb.checked = false);
                document.getElementById('otroServicioContainer').style.display = 'none';
            }
            updateProgress();
            autoSave();
        });

        // Show/hide "otro servicio" input
        document.getElementById('servicioOtro').addEventListener('change', (e) => {
            const container = document.getElementById('otroServicioContainer');
            if (e.target.checked) {
                container.style.display = 'block';
            } else {
                container.style.display = 'none';
                document.getElementById('otro_servicio').value = '';
            }
        });

        // Validate custom hours (must be multiple of 4)
        document.getElementById('custom_hours').addEventListener('blur', (e) => {
            const value = parseInt(e.target.value);
            const errorEl = document.getElementById('customHoursError');
            const input = e.target;

            if (value && value % 4 !== 0) {
                input.classList.add('input-error');
                errorEl.classList.add('show');
            } else {
                input.classList.remove('input-error');
                errorEl.classList.remove('show');
            }
            updateProgress();
        });

        // Validate participants (5-100)
        document.getElementById('participants').addEventListener('blur', (e) => {
            const value = parseInt(e.target.value);
            const errorEl = document.getElementById('participantsError');
            const input = e.target;

            if (value && (value < 5 || value > 100)) {
                input.classList.add('input-error');
                errorEl.classList.add('show');
            } else {
                input.classList.remove('input-error');
                errorEl.classList.remove('show');
            }
            updateProgress();
        });

        // Set min date for start_date (today)
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('start_date').setAttribute('min', today);

        // Validate start date
        document.getElementById('start_date').addEventListener('change', (e) => {
            const value = e.target.value;
            const errorEl = document.getElementById('startDateError');
            const input = e.target;

            if (value && value < today) {
                input.classList.add('input-error');
                errorEl.classList.add('show');
            } else {
                input.classList.remove('input-error');
                errorEl.classList.remove('show');

                // Update min for end_date
                document.getElementById('end_date').setAttribute('min', value);

                // Revalidate end_date
                validateField('end_date');
            }
            updateProgress();
            autoSave();
        });

        // Validate end date
        document.getElementById('end_date').addEventListener('change', (e) => {
            const startDate = document.getElementById('start_date').value;
            const endDate = e.target.value;
            const errorEl = document.getElementById('endDateError');
            const input = e.target;

            if (startDate && endDate && endDate < startDate) {
                input.classList.add('input-error');
                errorEl.classList.add('show');
            } else {
                input.classList.remove('input-error');
                errorEl.classList.remove('show');
            }
            updateProgress();
            autoSave();
        });

        // Validate field function
        function validateField(fieldId) {
            const field = document.getElementById(fieldId);
            if (!field) return true;

            const value = field.value.trim();
            let isValid = true;
            let errorEl = null;

            switch(fieldId) {
                case 'name':
                    errorEl = document.getElementById('nameError');
                    isValid = value.length >= 3;
                    break;
                case 'email':
                    errorEl = document.getElementById('emailError');
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    isValid = emailRegex.test(value);
                    break;
                case 'cost_center':
                    errorEl = document.getElementById('costCenterError');
                    const ccRegex = /^CC-\d{4}-[A-Z0-9]{3}$/;
                    isValid = ccRegex.test(value);
                    break;
            }

            if (errorEl) {
                if (!isValid && value) {
                    field.classList.add('input-error');
                    errorEl.classList.add('show');
                } else {
                    field.classList.remove('input-error');
                    errorEl.classList.remove('show');
                }
            }

            return isValid;
        }

        // Add blur validators
        ['name', 'email', 'cost_center'].forEach(fieldId => {
            document.getElementById(fieldId).addEventListener('blur', () => {
                validateField(fieldId);
                updateProgress();
                autoSave();
            });
        });

        // File upload handling
        const fileInput = document.getElementById('file_upload');
        const dropZone = document.getElementById('dropZone');

        fileInput.addEventListener('change', handleFileSelect);

        // Drag & Drop
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('drag-over');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('drag-over');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');

            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                handleFileSelect({ target: fileInput });
            }
        });

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (!file) return;

            // Validate extension
            const validExtensions = ['.xlsx', '.xls', '.csv'];
            const fileName = file.name.toLowerCase();
            const isValidExt = validExtensions.some(ext => fileName.endsWith(ext));

            if (!isValidExt) {
                showToast('Formato de archivo no válido', 'error');
                fileInput.value = '';
                return;
            }

            // Validate size (5MB)
            const maxSize = 5 * 1024 * 1024; // 5MB in bytes
            if (file.size > maxSize) {
                showToast('El archivo excede el tamaño máximo de 5MB', 'error');
                fileInput.value = '';
                return;
            }

            // Show loading
            dropZone.style.opacity = '0.5';
            setTimeout(() => {
                archivoSubido = file;
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('fileSize').textContent = `${(file.size / 1024).toFixed(2)} KB`;
                document.getElementById('fileInfo').style.display = 'block';
                dropZone.style.opacity = '1';
                updateProgress();
                autoSave();
            }, 2000);
        }

        function removeFile() {
            archivoSubido = null;
            fileInput.value = '';
            document.getElementById('fileInfo').style.display = 'none';
            updateProgress();
        }

        // Descargar plantilla Excel
        function descargarPlantilla() {
            // Create CSV content
            const csvContent = "Nombre,RUT,Email,Edad,Cargo\nJuan Pérez,12.345.678-9,juan.perez@empresa.cl,35,Supervisor\nMaría González,98.765.432-1,maria.gonzalez@empresa.cl,28,Técnico";

            // Create blob
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'Plantilla_Participantes_OTEC.csv';
            link.click();

            showToast('Plantilla descargada correctamente', 'success');
        }

        // Toast notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
                <span class="material-symbols-outlined text-${type === 'success' ? 'green' : 'red'}-600">
                    ${type === 'success' ? 'check_circle' : 'error'}
                </span>
                <span class="font-medium">${message}</span>
            `;
            document.body.appendChild(toast);

            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Update progress bar
        function updateProgress() {
            const requiredFields = [
                'name', 'email', 'holding', 'cost_center',
                'course_name', 'training_type', 'modality', 'hours_qty',
                'participants', 'start_date', 'end_date'
            ];

            let completed = 0;
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field && field.value) {
                    completed++;
                }
            });

            // Add file upload to progress
            if (archivoSubido) completed++;

            const total = requiredFields.length + 1; // +1 for file
            const percentage = (completed / total) * 100;

            document.getElementById('progressBarFill').style.width = `${percentage}%`;

            // Enable/disable submit button
            const isFormValid = completed === total && validateAllFields();
            document.getElementById('btnSubmit').disabled = !isFormValid;
        }

        // Validate all fields
        function validateAllFields() {
            const name = validateField('name');
            const email = validateField('email');
            const costCenter = validateField('cost_center');

            const participants = parseInt(document.getElementById('participants').value);
            const participantsValid = participants >= 5 && participants <= 100;

            const startDate = document.getElementById('start_date').value;
            const endDate = document.getElementById('end_date').value;
            const datesValid = startDate && endDate && endDate >= startDate && startDate >= today;

            const hoursQty = document.getElementById('hours_qty').value;
            let hoursValid = true;
            if (hoursQty === 'otro') {
                const customHours = parseInt(document.getElementById('custom_hours').value);
                hoursValid = customHours && customHours % 4 === 0;
            }

            return name && email && costCenter && participantsValid && datesValid && hoursValid && archivoSubido;
        }

        // Auto-save to localStorage
        function autoSave() {
            const form = document.getElementById('formSolicitud');
            const data = new FormData(form);
            const obj = {};
            data.forEach((value, key) => obj[key] = value);

            obj.archivo = archivoSubido ? archivoSubido.name : null;

            localStorage.setItem('otec_solicitud_draft', JSON.stringify(obj));
        }

        // Load draft from localStorage
        function loadDraft() {
            const draft = localStorage.getItem('otec_solicitud_draft');
            if (draft) {
                const data = JSON.parse(draft);
                Object.keys(data).forEach(key => {
                    const field = document.getElementById(key);
                    if (field && data[key]) {
                        field.value = data[key];
                    }
                });
            }
        }

        // Cancel button
        document.getElementById('btnCancelar').addEventListener('click', () => {
            if (confirm('¿Está seguro? Se perderán los datos ingresados')) {
                localStorage.removeItem('otec_solicitud_draft');
                window.location.href = 'solicitudes-listado.html';
            }
        });

        // Form submit
        document.getElementById('formSolicitud').addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!validateAllFields()) {
                showToast('Por favor complete todos los campos requeridos', 'error');
                return;
            }

            const submitBtn = document.getElementById('btnSubmit');
            const submitText = document.getElementById('submitText');
            const submitIcon = document.getElementById('submitIcon');
            const submitLoader = document.getElementById('submitLoader');

            // Show loader
            submitBtn.disabled = true;
            submitText.textContent = 'Enviando...';
            submitIcon.style.display = 'none';
            submitLoader.style.display = 'inline-block';

            // Simulate API call
            setTimeout(() => {
                // Collect form data
                const formData = new FormData(e.target);
                const solicitud = {
                    id: Date.now(),
                    nombre: formData.get('name') || document.getElementById('name').value,
                    email: formData.get('email') || document.getElementById('email').value,
                    empresa: mockEmpresas.find(e => e.id == document.getElementById('holding').value)?.nombre,
                    centroGestion: document.getElementById('cost_center').value,
                    curso: document.getElementById('course_name').value,
                    tipo: document.getElementById('training_type').value,
                    modalidad: document.getElementById('modality').value,
                    horas: document.getElementById('hours_qty').value === 'otro'
                        ? document.getElementById('custom_hours').value
                        : document.getElementById('hours_qty').value,
                    participantes: document.getElementById('participants').value,
                    fechaInicio: document.getElementById('start_date').value,
                    fechaTermino: document.getElementById('end_date').value,
                    horario: document.getElementById('schedule').value,
                    archivo: archivoSubido?.name,
                    fecha: new Date().toISOString(),
                    estado: 'pendiente'
                };

                // Save to localStorage
                const solicitudes = JSON.parse(localStorage.getItem('otec_solicitudes') || '[]');
                solicitudes.push(solicitud);
                localStorage.setItem('otec_solicitudes', JSON.stringify(solicitudes));

                // Clear draft
                localStorage.removeItem('otec_solicitud_draft');

                // Show success toast
                showToast('Solicitud enviada correctamente', 'success');

                // Redirect
                setTimeout(() => {
                    window.location.href = 'solicitudes-listado.html';
                }, 1500);
            }, 2000);
        });

        // Add input listeners for progress update
        document.querySelectorAll('input, select, textarea').forEach(el => {
            el.addEventListener('input', () => {
                updateProgress();
                autoSave();
            });
        });

        // Initialize
        populateEmpresas();
        loadDraft();
        updateProgress();
    </script>
</body>
</html>
